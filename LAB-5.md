# **LAB-5**
**АНАЛИЗ ЗАГРЯЗНЕНИЯ ОКРУЖАЮЩЕЙ СРЕДЫ**

## **TASK-1**

* Написать функцию `pmean`, которая считает среднее значение (mean)
загрязнения сульфатами или нитратами среди данного перечня мониторов.
```
Данная функция принимает 3 аргумента: 
«directory» - папка в которой находятся данные 
«pollutant» - вид загрязнения
«id» - список мониторов 
По умолчанию аргумент id имеет значение 1:332.
(функція должна игнорировать NA значения) 
```
```
ПРИМЕРЫ РАБОТЫ ФУНКЦИИ:

pmean("specdata", "sulfate", 1:10)
## [1] 4.064128

pmean("specdata", "sulfate", 55)
## [1] 3.587319

pmean("specdata", "nitrate")
## [1] 1.702932
```
```
NEW.FILE <- function(name) {
  l <- 3L
  name <- paste('000', name, sep = '')
  
  return(paste(substr(
    name,
    nchar(name) - l+1,
    nchar(name)
  ), '.csv', sep = ''))
}
```
```
#РЕАЛИЗАЦИЯ:
pmean <- function(directory, pollutant, id = c(1:332)) {
    way <-
    paste('C:/Users/USER/data/', directory, '/', sep = "")
    cifra <- c()
  
  for (i in id) {
    rf<-
    read.csv(file = paste(way, NEW.FILE(i), sep = ""))
    cn <- colnames(rf)
    
    if (pollutant %in% cn) {
      cifra <- c(cifra, rf[, pollutant, drop = TRUE])
    }
  }
  return(mean(cifra, na.rm = TRUE))
}
```
```
#ПРОВЕРКА:
t1 <- pmean("specdata", "sulfate", 1:10)
t1
t2 <- pmean("specdata", "sulfate", 55)
t2
t3 <- pmean("specdata", "nitrate")
t3
```
```
[1] 4.064128
[1] 3.587319
[1] 1.702932
```

## **TASK-2**

* Написать функцию `complete`, которая выводит количество полных наблюдений
(the number of completely observed cases) для каждого файла. 
```
Данная функция принимает 2 аргумента: 
«directory» 
«id» 
и возвращает data frame: 1ый столбец – имя файла, 2ой – кол-во полных наблюдений
```
```
ПРИМЕРЫ РАБОТЫ ФУНКЦИИ:

complete("specdata", 1)
##   id nobs
## 1 1 117

complete("specdata", c(2, 4, 8, 10, 12))
##   id nobs
## 1 2 1041
## 2 4 474
## 3 8 192
## 4 10 148
## 5 12 96

complete("specdata", 50:60)
##   id nobs
## 1 50 459
## 2 51 193
## 3 52 812
## 4 53 342
## 5 54 219
## 6 55 372
## 7 56 642
## 8 57 452
## 9 58 391
## 10 59 445
## 11 60 448
```
```
#РЕАЛИЗАЦИЯ:
complete <- function(directory, id) {
    way <-
    paste('C:/Users/USER/data/', directory, '/', sep = "")
    d.base <- data.frame(filename = character(), count = integer())
  
  for (i in id) {
    sup.file<- NEW.FILE(i)
    
    rf <-
      read.csv(file = paste(way, sup.file, sep = ""))
    
      ad.plus <- sum(!is.na(rf['nitrate'] & rf['sulfate']))
    
      form.vec <- list(id = sup.file, nobs = ad.plus)
      d.base = rbind(d.base, form.vec, stringsAsFactors = FALSE)
  }
  
  return(d.base)
}

#ПРОВЕРКА:
a <- complete("specdata", 1)
a
b <- complete("specdata", c(2, 4, 8, 10, 12))
b
c <- complete("specdata", 50:60)
c
```
```
        id nobs
1 001.csv  117

        id nobs
1 002.csv 1041
2 004.csv  474
3 008.csv  192
4 010.csv  148
5 012.csv   96

        id nobs
1  050.csv  459
2  051.csv  193
3  052.csv  812
4  053.csv  342
5  054.csv  219
6  055.csv  372
7  056.csv  642
8  057.csv  452
9  058.csv  391
10 059.csv  445
11 060.csv  448
```


## **TASK-3**

* Написать функцию `corr`
```
Данная функция принимает 2 аргумента: 
directory (папка, где находяться файлы наблюдений)
threshold (пороговое значение, по умолчанию=0) 
и считает корреляцию между сульфатами и нитратами для мониторов, 
кол-во полных наблюдений для которых больше порогового значення. 

Функция должна вернуть вектор значений корреляций.
Если ни один монитор не превышает порогового значения,
функция должна вернуть numeric вектор ддлинною = 0. 

Для расчета корреляции между сульфатами та нитратами - 
функция «corr» с параметрами по умолчанию.
```
```
ПРИМЕРЫ РАБОТЫ ФУНКЦИИ:

cr <- corr("specdata", 150)
head(cr) 
summary(cr)

## [1] -0.01895754 -0.14051254 -0.04389737 -0.06815956 -0.12350667 -
0.07588814
## Min. 1st Qu. Median Mean 3rd Qu. Max.
## -0.21060 -0.04999 0.09463 0.12530 0.26840 0.76310

cr <- corr("specdata", 400)
head(cr)
summary(cr)

## [1] -0.01895754 -0.04389737 -0.06815956 -0.07588814 0.76312884 -
0.15782860
## Min. 1st Qu. Median Mean 3rd Qu. Max.
## -0.17620 -0.03109 0.10020 0.13970 0.26850 0.76310

cr <- corr("specdata", 5000)
head(cr)
summary(cr)
length(cr)

## NULL
## NULL
## Length Class Mode
## 0 NULL NULL
## [1] 0
```

```
#РЕАЛИЗАЦИЯ:
corr <- function(directory, threshold = 0) {
    way <-
    paste('C:/Users/USER/data/', directory, '/', sep = "")
  
    main.list <- list.files(way)
  
    cifra <- c()
  
  
  for (i in main.list) {
      rf <-
      read.csv(file = paste(way, i, sep = ""))
    
      ad.plus <- sum(!is.na(rf['nitrate'] & rf['sulfate']))
    
    if (ad.plus >= threshold) {
      f_subset <- rf[!is.na(rf$sulfate) & !is.na(rf$nitrate), ]
      cor_value <- cor(f_subset$sulfate, f_subset$nitrate)
      cifra <- c(cifra, cor_value)
    }
  }
  return (cifra)
}
```
```
# ПРОВЕРКА: 
cr1 <- corr("specdata", 150)
cr1
cr11 <- head(cr1)
cr11
cr111 <- summary(cr1)
cr111

cr2 <- corr("specdata", 400)
cr2
cr22 <- head(cr2)
cr22
cr222 <- summary(cr2)
cr222


cr3 <- corr("specdata", 5000)
cr3
cr33 <- head(cr3)
cr33
cr333 <- summary(cr3)
cr333
cr3333 <- length(cr3)
cr3333
```
```
> cr1 <- corr("specdata", 150)
> cr1
  [1] -0.018957541 -0.140512544 -0.043897372 -0.068159562 -0.123506666 -0.075888144 -0.159673652 -0.086841940
  [9]  0.763128837 -0.157828603 -0.156998919 -0.044898818  0.117249264  0.259057178  0.133274607  0.366201078
 [17]  0.580751264  0.006863930  0.726693888  0.057741676  0.115338086  0.465754012  0.515804375  0.412693537
 [25]  0.375631176  0.315725317  0.244560561  0.594426499  0.553514976  0.614340566  0.460513619  0.405022501
 [33]  0.434789780  0.088421364  0.118136697 -0.091022820 -0.033091304  0.440660466 -0.029683708  0.268525390
 [41]  0.277220958 -0.049108453  0.322627410  0.091139374 -0.025750053  0.120521602 -0.061746831  0.041306963
 [49] -0.146202136 -0.162485185 -0.097254393  0.089262856  0.568403991  0.711864008  0.268203237  0.190644585
 [57]  0.227222983  0.229238882  0.005635506  0.018628108 -0.064750174  0.096614297  0.002864405  0.107184775
 [65]  0.128477284 -0.042533572 -0.137041337  0.136609030  0.118975253  0.098073855  0.066928310  0.100212474
 [73] -0.063984344 -0.066525489 -0.129245884 -0.111066409 -0.089441210 -0.114090325 -0.106280702 -0.176855164
 [81] -0.116984680  0.019138583  0.100643502 -0.073858484  0.036665921 -0.107957809 -0.167955891  0.296744105
 [89]  0.347421569  0.146528765  0.362414577  0.093330832  0.198915192  0.164602262  0.180626975  0.176508543
 [97]  0.139158631  0.231984399  0.227615918  0.275903634  0.299630040  0.248143145  0.298344178 -0.056325366
[105] -0.178114558  0.002032940 -0.022802183 -0.001202233  0.085217423 -0.076409023  0.010021716  0.016411646
[113] -0.038785934 -0.075297768  0.041917773  0.193324040  0.596929143  0.113596590 -0.143750037 -0.017703373
[121]  0.284905360  0.305506111  0.150031306  0.134895077  0.172850003  0.286076203 -0.106687748  0.244744168
[129]  0.337120085  0.424798956  0.095921881  0.022899033  0.143330735  0.087196218  0.408741028  0.425176879
[137]  0.361728434 -0.035090337 -0.082388453 -0.094742313 -0.087573726 -0.060405837 -0.092398269 -0.183197353
[145]  0.124650112 -0.053001162 -0.039911536  0.010158287  0.451828854  0.295793699  0.615268727 -0.075214053
[153]  0.132207405  0.089547098 -0.019086127 -0.045552626  0.211599525 -0.073972834  0.112668377  0.138387891
[161] -0.003207550 -0.052643174  0.042168144 -0.067460173 -0.030882797  0.017805647  0.026138073 -0.050287543
[169]  0.016535643  0.199919014  0.482158286  0.355110474  0.589606340  0.368038099 -0.029094866 -0.074495323
[177]  0.262101561 -0.005386993  0.258826380  0.144110820  0.101915017  0.023020993  0.074594252  0.256665139
[185]  0.162401158 -0.003454405  0.190141976  0.184581239  0.120596460 -0.176233152 -0.144699131  0.147074115
[193]  0.273520382  0.109557323 -0.092863394 -0.182752126 -0.008836513  0.356592359 -0.089133895 -0.017185129
[201] -0.156323514 -0.042538204  0.010235676 -0.009912754 -0.042910367 -0.210567709 -0.155957816  0.046211272
[209] -0.060808231  0.160865053  0.615095781  0.598343330  0.506535631  0.191834811 -0.024723462 -0.150627164
[217] -0.002500089 -0.166201361  0.619349867  0.531380642  0.520115665  0.466673962  0.518820173  0.394191512
[225]  0.379446208 -0.123172036 -0.061565518 -0.180133963  0.253978075  0.139867175  0.316429404  0.268780500
[233]  0.279397143  0.267260662  0.287133842
> cr11 <- head(cr1)
> cr11
[1] -0.01895754 -0.14051254 -0.04389737 -0.06815956 -0.12350667 -0.07588814
> cr111 <- summary(cr1)
> cr111
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.21057 -0.05147  0.09333  0.12401  0.26836  0.76313 
-----------------------------------------------------------------------------------------------------------

> cr2 <- corr("specdata", 400)
> cr2
  [1] -0.018957541 -0.043897372 -0.068159562 -0.075888144  0.763128837 -0.157828603 -0.044898818  0.117249264
  [9]  0.259057178  0.133274607  0.366201078  0.006863930  0.726693888  0.057741676  0.115338086  0.465754012
 [17]  0.515804375  0.375631176  0.315725317  0.244560561  0.594426499  0.553514976  0.405022501  0.434789780
 [25]  0.088421364  0.118136697 -0.033091304  0.277220958 -0.049108453  0.091139374 -0.025750053 -0.061746831
 [33]  0.041306963 -0.146202136 -0.097254393  0.089262856  0.711864008  0.268203237  0.190644585  0.002864405
 [41] -0.042533572  0.098073855  0.100212474 -0.063984344 -0.066525489 -0.089441210  0.100643502  0.036665921
 [49]  0.296744105  0.347421569  0.198915192  0.164602262  0.231984399  0.275903634  0.248143145  0.002032940
 [57]  0.085217423  0.010021716 -0.038785934  0.041917773  0.596929143  0.113596590 -0.017703373  0.305506111
 [65]  0.150031306  0.134895077  0.172850003  0.286076203  0.337120085  0.424798956  0.095921881  0.022899033
 [73]  0.143330735  0.408741028  0.361728434 -0.035090337 -0.082388453 -0.094742313 -0.092398269 -0.053001162
 [81]  0.010158287  0.295793699 -0.075214053  0.132207405  0.089547098 -0.019086127  0.138387891 -0.003207550
 [89]  0.017805647 -0.050287543  0.016535643  0.355110474  0.589606340 -0.029094866 -0.074495323 -0.005386993
 [97]  0.258826380  0.144110820  0.074594252  0.256665139  0.162401158  0.190141976 -0.176233152 -0.144699131
[105]  0.147074115  0.273520382  0.109557323 -0.092863394 -0.089133895 -0.017185129 -0.156323514 -0.042538204
[113] -0.009912754 -0.042910367  0.046211272 -0.060808231  0.160865053  0.598343330  0.506535631  0.191834811
[121] -0.024723462  0.518820173 -0.123172036  0.253978075  0.268780500  0.279397143  0.267260662
> cr22 <- head(cr2)
> cr22
[1] -0.01895754 -0.04389737 -0.06815956 -0.07588814  0.76312884 -0.15782860
> cr222 <- summary(cr2)
> cr222
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.17623 -0.03109  0.10021  0.13969  0.26849  0.76313 
-------------------------------------------------------------------------------------------------------------

> cr3 <- corr("specdata", 5000)
> cr3
NULL
> cr33 <- head(cr3)
> cr33
NULL
> cr333 <- summary(cr3)
> cr333
Length  Class   Mode 
     0   NULL   NULL 
> cr3333 <- length(cr3)
> cr3333
[1] 0
```
